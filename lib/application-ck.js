/*
 * Copyright (c) 2012 Adobe Systems Incorporated. All rights reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function e(){this.checkFeatures();$("#loading").remove();this.mainViewEl=$("#main-view").show();this.helpButtonEl=$("#help-link");this.helpPopupCloseEl=$("#help-popup-close");this.helpPopupCloseEl.click(this.onHelpPopupCloseClicked.bind(this));this.helpButtonEl.click(this.onHelpClicked.bind(this));this.helpPopupEl=$("#help-popup").detach();this.browserPopupCloseEl=$("#browser-popup-close");this.browserPopupCloseEl.click(this.onBrowserPopupCloseClicked.bind(this));this.browserPopupEl=$("#browser-popup").detach();this.config=new Global.Config;this.config.load(filterConfigs);this.github=new Global.GitHub;this.fileSystem=new Global.LocalStorage;this.filterStore=new Global.FilterStore(this.config,this.fileSystem,this.github);this.filterList=new Global.FilterList(this.filterStore);this.animation=new Global.Animation(this.filterList,this.filterStore);this.presets=new Global.PresetStore(this.fileSystem,this.filterStore,this.animation);this.timelineView=new Global.TimelineView(this.animation);this.shaderEditorView=new Global.ShaderEditorView(this.filterStore,this.github);this.activeFilterListView=new Global.ActiveFilterListView(this.filterList);this.builtinFilterStoreView=new Global.FilterStoreView(this.filterStore,this.filterList,this.activeFilterListView,this.shaderEditorView,"builtins");this.customFilterStoreView=new Global.FilterStoreView(this.filterStore,this.filterList,this.activeFilterListView,this.shaderEditorView,"custom");this.forkedFilterStoreView=new Global.FilterStoreView(this.filterStore,this.filterList,this.activeFilterListView,this.shaderEditorView,"forked");this.cssCodeView=new Global.CSSCodeView(this.animation);this.presetStoreView=new Global.PresetStoreView(this.presets);this.dockView=new Global.DockView($("#app"));this.filterDock=new Global.DockView($("#filter-dock"));this.logoView=new Global.LogoView(this.filterDock,this.filterStore);this.containerDockPanel=new Global.DockPanel("Document");this.targetEl=$("#container");$("#main").appendTo(this.containerDockPanel.el);this.unsupportedPopupEl=$("#filters-not-supported-popup").detach();$("#components").remove();this.init()}e.prototype={init:function(){this.dockView.addVerticalColumn().setMinSize(350).setWidth(350).addContainer().setFixed().setHeight(45).add(this.logoView.dockPanel).removeTabs().column.addContainer().add(this.activeFilterListView.dockPanel).setIsDocumentArea().removeTabs();this.dockView.addVerticalColumn().setMinSize(400).setIsDocumentArea().addClass("light").addContainer().setFixed().setHeight(45).add(this.presetStoreView.dockPanel).removeTabs().column.addContainer().add(this.containerDockPanel).setIsDocumentArea().removeTabs().column.addContainer().setHeight(150).add(this.cssCodeView.dockPanelCode).add(this.cssCodeView.dockPanelAnimationCode).column.addContainer(!0).setFixed().setHeight(50).add(this.timelineView.dockPanel).removeTabs();this.shaderEditorView.dockView=this.dockView;this.filterDock.add(this.builtinFilterStoreView.dockPanel).add(this.customFilterStoreView.dockPanel).add(this.forkedFilterStoreView.dockPanel);this.targetEl.css("-webkit-transform","translate3d(0,0,0)");this.animation.on("filtersUpdated",this.onFiltersUpdated.bind(this));this.animation.update();this.filterStore.loadFilterConfigurations();this.setupFilterSelectListeners();this.checkMinimumFeatures()},onFiltersUpdated:function(e,t,n){this.targetEl.css("-webkit-filter",e)},prefixes:["","-webkit-","-moz-","-ms-","-o-"],checkFeatureWithPropertyPrefix:function(e,t){var n=$("<div />");for(var r=0;r<this.prefixes.length;++r){var i=this.prefixes[r]+e;if(n.css(i,t).css(i)==t)return!0}return!1},checkFeatureWithValuePrefix:function(e,t){var n=$("<div />");for(var r=0;r<this.prefixes.length;++r){var i=this.prefixes[r]+t;if(n.css(e,i).css(e)==i)return!0}return!1},checkFeatures:function(){this.supportsFlex=this.checkFeatureWithValuePrefix("display","flex")||this.checkFeatureWithValuePrefix("display","box");this.supportsFilters=this.checkFeatureWithPropertyPrefix("filter","sepia(100%)");this.supportsCustomFilters=this.checkFeatureWithPropertyPrefix("filter","custom(none mix(url(http://www.example.com/)))")},checkMinimumFeatures:function(){!this.supportsFlex||!this.supportsFilters?this.showBrowserCheckPopup():this.checkFirstTimeLoad();if(!this.supportsCustomFilters){this.unsupportedPopupEl.find(".filters-not-supported-help").click(this.showCustomFilterCheckPopup.bind(this));this.customFilterStoreView.insertUnsupportedPopup(this.unsupportedPopupEl);this.forkedFilterStoreView.insertUnsupportedPopup(this.unsupportedPopupEl)}},showBrowserCheckPopup:function(){this.mainViewEl.hide();this.browserPopupCloseEl.hide();this.browserPopupEl.appendTo(document.body).show()},showCustomFilterCheckPopup:function(){this.browserPopupCloseEl.show();this.browserPopupEl.appendTo(document.body).show()},onHelpClicked:function(){this.helpPopupEl.appendTo(document.body).show()},onHelpPopupCloseClicked:function(){this.helpPopupEl.detach();if(this.firstRun){this.fileSystem.save("first_run","no");this.firstRun=!1}},onBrowserPopupCloseClicked:function(){this.browserPopupEl.detach()},setupFilterSelectListeners:function(){var e=this;$.each([this.builtinFilterStoreView,this.customFilterStoreView,this.forkedFilterStoreView],function(t,n){n.on("filterSelected",function(){e.logoView.hideFilterDock.call(e.logoView)})})},showFirstRunPopup:function(){this.firstRun=!0;this.helpPopupEl.appendTo(document.body).show()},checkFirstTimeLoad:function(){var e=this;this.firstRun=!1;this.fileSystem.get("first_run",function(t,n){n!="no"&&e.showFirstRunPopup()})}};$(function(){var t=window.app=new e});Global.Application=e})();